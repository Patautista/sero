@using MauiApp1.Services
@inject SharedTextService SharedTextService
@inject NavigationManager Navigation
@inject MauiApp1.Services.DatabaseService DatabaseService
@implements IDisposable

@code {
    protected override void OnInitialized()
    {
        SharedTextService.TextReceived += OnTextReceived;
    }

    private async void OnTextReceived(object? sender, string text)
    {
        var encodedText = Uri.EscapeDataString(text);
        
        // Navigate to selection page where user can choose to analyze or create card
        await MainThread.InvokeOnMainThreadAsync(() =>
        {
            Navigation.NavigateTo($"/shared-text-select/{encodedText}");
        });
    }

    public void Dispose()
    {
        SharedTextService.TextReceived -= OnTextReceived;
    }
}