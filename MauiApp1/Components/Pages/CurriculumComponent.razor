<div class="curriculum-container">
    <h1 class="text-3xl font-bold mb-8 text-center text-indigo-700">@curriculum.Name</h1>

    <div class="sections-trail">
        @foreach (var curriculumSection in curriculum.Sections.OrderBy(s => s.RequiredExp))
        {
            <div class="section-card transition-all duration-300 transform hover:scale-105"
                 @onclick="() => OpenModal(curriculumSection)">
                <div class="section-icon">
                    <span class="text-4xl">📚</span>
                </div>
                <div class="section-info">
                    <h3 class="font-semibold text-lg">@curriculumSection.Title</h3>
                    @if(curriculumSection.RequiredExp > userExp){
                        <p class="text-sm text-gray-600">Nível @ExpCalculator.GetLevel(curriculumSection.RequiredExp)</p>
                    }
                </div>
            </div>
            @if (curriculumSection != curriculum.Sections.Last())
            {
                <div class="trail-line"></div>
            }
        }
    </div>
</div>

@if (showModal && selectedSection != null)
{
    <div class="modal-backdrop"></div>
    <div class="modal fade show d-block" tabindex="-1" role="dialog">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content rounded-xl shadow-lg">
                <div class="modal-header bg-indigo-600 text-white rounded-t-xl">
                    <h5 class="modal-title font-semibold">Cartões em @selectedSection.Title</h5>
                    <button type="button" class="btn-close text-white" @onclick="CloseModal"></button>
                </div>
                <div class="modal-body p-6">
                    <div class="card-gallery grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        @if (selectedSection.Cards.Any())
                        {
                            @foreach (var card in selectedSection.Cards)
                            {
                                <div class="card shadow-md rounded-lg overflow-hidden bg-gray-50 transition-all duration-200 transform hover:translate-y-[-5px]">
                                    <div class="p-4">
                                        <p class="text-sm text-gray-500 mb-2">
                                            <span class="font-medium text-gray-700">@card.NativeSentence.Language.ToUpper():</span> @card.NativeSentence.Text
                                        </p>
                                        <p class="text-lg font-bold mb-2 text-indigo-800">
                                            <span class="font-medium text-gray-700">@card.TargetSentence.Language.ToUpper():</span> @card.TargetSentence.Text
                                        </p>
                                        <div class="flex flex-wrap gap-1">
                                            @foreach (var tag in card.Tags)
                                            {
                                                <span class="badge bg-indigo-200 text-black-800 px-2 py-1 rounded-full text-xs font-medium">@tag.Name</span>
                                            }
                                            <span class="badge bg-green-200 text-green-800 px-2 py-1 rounded-full text-xs font-medium">@card.DifficultyLevel</span>
                                        </div>
                                    </div>
                                </div>
                            }
                        }
                        else
                        {
                            <p class="text-center text-gray-500 col-span-full">No cards available for this section.</p>
                        }
                    </div>
                </div>
                <div class="modal-footer justify-center border-t border-gray-200 pt-4">
                    <button type="button" class="btn btn-secondary bg-gray-200 text-gray-700 px-4 py-2 rounded-lg" @onclick="CloseModal">Close</button>
                </div>
            </div>
        </div>
    </div>
}

@code {
    private Curriculum curriculum = new();
    private int userExp;
    private CurriculumSection? selectedSection;
    private bool showModal = false;

    protected async override Task OnInitializedAsync()
    {
        // Sample data to make the component runnable
        userExp = await MemoryService.GetUserExpAsync();
        curriculum = await MemoryService.GetCurriculumAsync(); 
    }

    private void OpenModal(CurriculumSection section)
    {
        selectedSection = section;
        showModal = true;
    }

    private void CloseModal()
    {
        showModal = false;
        selectedSection = null;
    }

}

<style>
    .curriculum-container {
        padding: 40px;
        background-color: #f7f9fc;
        border-radius: 12px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
        max-width: 1200px;
        margin: auto;
    }

    .sections-trail {
        display: flex;
        flex-direction: row;
        align-items: center;
        flex-wrap: nowrap;
        overflow-x: auto;
        padding: 20px 0;
    }

    .section-card {
        flex-shrink: 0;
        display: flex;
        flex-direction: column;
        align-items: center;
        text-align: center;
        background-color: #ffffff;
        border: 2px solid #e2e8f0;
        border-radius: 50%;
        padding: 20px;
        width: 150px;
        height: 150px;
        margin: 0 10px;
        cursor: pointer;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        position: relative;
        z-index: 10;
    }

        .section-card:hover {
            border-color: #4f46e5;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

    .section-icon {
        background-color: #e0e7ff;
        border-radius: 50%;
        width: 60px;
        height: 60px;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-bottom: 8px;
    }

    .section-info h3, .section-info p {
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        width: 100px;
    }

    .trail-line {
        flex-grow: 1;
        height: 4px;
        background-color: #a5b4fc;
        position: relative;
        top: 0px;
        z-index: 5;
    }

    .modal-backdrop {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        z-index: 1040;
    }
</style>
